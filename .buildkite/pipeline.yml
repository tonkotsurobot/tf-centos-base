env:
  BUILDKITE_CLEAN_CHECKOUT: true

steps:
  - name: "validate .tf files"
    plugins:
      docker-compose:
        pull: test
        run: test
    agents:
      vm: "true"
      home: "true"
      docker: "true"

  - name: "destroy resources"
    plugins:
      docker-compose:
        pull: destroy
        run: destroy
    agents:
      vm: "true"
      home: "true"
      docker: "true"

  - wait
  
  - name: "build resources"
    plugins:
      docker-compose:
        pull: build
        run: build
    agents:
      vm: "true"
      home: "true"